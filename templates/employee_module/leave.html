{% extends "employee_module/base.html" %}
{% block title %}Leave Management{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header mb-4">
    <h2><i class="bi bi-calendar-x"></i> Leave Management</h2>
</div>

<!-- Leave Balance Card -->
<div class="card mb-4">
    <div class="card-header">
        <i class="bi bi-wallet2"></i> Leave Balance ({{ leave_balance.year }})
    </div>
    <div class="card-body">
        <div class="row g-3">
            <div class="col-md-4">
                <div class="text-muted small">Sick Leave</div>
                <div class="h2 mb-0 text-info">{{ leave_balance.sick_leave }}</div>
            </div>
            <div class="col-md-4">
                <div class="text-muted small">Casual Leave</div>
                <div class="h2 mb-0 text-success">{{ leave_balance.casual_leave }}</div>
            </div>
            <div class="col-md-4">
                <div class="text-muted small">Earned Leave</div>
                <div class="h2 mb-0 text-primary">{{ leave_balance.earned_leave }}</div>
            </div>
        </div>
    </div>
</div>

<!-- Apply Leave Form -->
<div class="card mb-4">
    <div class="card-header">
        <i class="bi bi-plus-circle"></i> Apply for Leave
    </div>
    <div class="card-body">
        <form method="post" action="{% url 'employee:apply_leave' %}">
            {% csrf_token %}
            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label class="form-label">Leave Type</label>
                    <select name="leave_type" required class="form-select">
                        <option value="">Select Type</option>
                        <option value="Sick Leave">Sick Leave</option>
                        <option value="Casual Leave">Casual Leave</option>
                        <option value="Earned Leave">Earned Leave</option>
                        <option value="Maternity Leave">Maternity Leave</option>
                        <option value="Paternity Leave">Paternity Leave</option>
                    </select>
                </div>
            </div>
            
            <div class="row g-3 mb-3">
                <div class="col-md-6">
                    <label class="form-label">Start Date</label>
                    <input type="date" name="start_date" required class="form-control">
                </div>
                <div class="col-md-6">
                    <label class="form-label">End Date</label>
                    <input type="date" name="end_date" required class="form-control">
                </div>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Reason</label>
                <textarea name="reason" required rows="3" class="form-control" placeholder="Enter reason for leave"></textarea>
            </div>
            
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-send"></i> Submit Leave Request
            </button>
        </form>
    </div>
</div>

<!-- Leave History -->
<div class="card">
    <div class="card-header">
        <i class="bi bi-clock-history"></i> Leave History
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>Leave Type</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Days</th>
                        <th>Reason</th>
                        <th>Status</th>
                        <th>Applied On</th>
                    </tr>
                </thead>
                <tbody>
                    {% for leave in leaves %}
                    <tr>
                        <td>{{ leave.leave_type }}</td>
                        <td>{{ leave.start_date }}</td>
                        <td>{{ leave.end_date }}</td>
                        <td>{{ leave.get_duration }}</td>
                        <td>{{ leave.reason|truncatewords:10 }}</td>
                        <td>
                            {% if leave.status == 'Approved' %}
                            <span class="badge bg-success">{{ leave.status }}</span>
                            {% elif leave.status == 'Rejected' %}
                            <span class="badge bg-danger">{{ leave.status }}</span>
                            {% else %}
                            <span class="badge bg-warning">{{ leave.status }}</span>
                            {% endif %}
                        </td>
                        <td>{{ leave.applied_at|date:"d M Y" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="text-center text-muted">
                            No leave applications yet
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}